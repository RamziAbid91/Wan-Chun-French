<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>French Words</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            /* Modern Color Palette */
            --primary: #4361ee;
            --primary-light: #4895ef;
            --secondary: #7209b7;
            --accent: #f72585;
            --success: #4cc9f0;
            --error: #f72585;
            --warning: #f8961e;
            --light: #ffffff;
            --dark: #1a1a2e;
            --gray-100: #f8f9fa;
            --gray-200: #e9ecef;
            --gray-300: #dee2e6;
            --gray-600: #6c757d;
            --gray-800: #343a40;
            
            /* Glassmorphism effects */
            --glass-bg: rgba(255, 255, 255, 0.85);
            --glass-border: rgba(255, 255, 255, 0.2);
            --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            
            /* Modern gradients */
            --gradient-primary: linear-gradient(135deg, #4361ee, #3a0ca3);
            --gradient-secondary: linear-gradient(135deg, #7209b7, #560bad);
            --gradient-accent: linear-gradient(135deg, #f72585, #b5179e);
            
            /* Modern shadows */
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.06);
            --shadow-md: 0 4px 20px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 8px 30px rgba(0, 0, 0, 0.12);
            --shadow-xl: 0 12px 40px rgba(0, 0, 0, 0.15);
            
            /* Modern borders */
            --radius-sm: 12px;
            --radius-md: 20px;
            --radius-lg: 28px;
            --radius-xl: 40px;
            
            /* Transitions */
            --transition-fast: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-normal: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            background: linear-gradient(135deg, #f8f9ff 0%, #f0f2ff 100%);
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
            padding-bottom: env(safe-area-inset-bottom);
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 20% 80%, rgba(67, 97, 238, 0.05) 0%, transparent 50%),
                       radial-gradient(circle at 80% 20%, rgba(114, 9, 183, 0.05) 0%, transparent 50%);
            z-index: -1;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Modern Header */
        header {
            background: var(--gradient-primary);
            color: white;
            padding: 3rem 0;
            text-align: center;
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
            padding-top: max(3rem, env(safe-area-inset-top));
            clip-path: polygon(0 0, 100% 0, 100% 90%, 0 100%);
        }

        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23ffffff' fill-opacity='0.1' fill-rule='evenodd'/%3E%3C/svg%3E");
            opacity: 0.1;
        }

        header h1 {
            font-size: clamp(2.2rem, 6vw, 3rem);
            margin-bottom: 0.8rem;
            font-weight: 800;
            position: relative;
            display: inline-block;
            background: linear-gradient(135deg, #fff 0%, rgba(255, 255, 255, 0.9) 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        header h1 i {
            background: linear-gradient(135deg, #fff 0%, #f0f0f0 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-right: 12px;
        }

        header p {
            font-size: clamp(1.1rem, 3vw, 1.3rem);
            opacity: 0.95;
            max-width: 700px;
            margin: 0 auto;
            position: relative;
            line-height: 1.6;
            font-weight: 400;
        }

        /* Modern Stats Bar */
        .stats-bar {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-lg);
            padding: 1.8rem 1rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-lg);
            gap: 20px;
            position: relative;
            z-index: 1;
        }

        .stat-item {
            text-align: center;
            padding: 0.5rem;
            position: relative;
        }

        .stat-item::after {
            content: '';
            position: absolute;
            right: -10px;
            top: 20%;
            height: 60%;
            width: 1px;
            background: linear-gradient(to bottom, transparent, var(--gray-300), transparent);
        }

        .stat-item:last-child::after {
            display: none;
        }

        .stat-number {
            font-size: clamp(2.2rem, 7vw, 2.8rem);
            font-weight: 800;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            line-height: 1;
            margin-bottom: 0.5rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .stat-label {
            color: var(--gray-600);
            font-size: clamp(0.9rem, 3vw, 1rem);
            font-weight: 500;
            letter-spacing: 0.5px;
        }

        /* Search & Filter Bar */
        .search-filter-bar {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            margin-bottom: 1.8rem;
            align-items: stretch;
        }

        .search-filter-bar .search-input,
        .search-filter-bar .filter-select {
            flex: 1;
            min-width: 200px;
            border-radius: var(--radius-xl);
            border: 1px solid var(--gray-300);
            padding: 0.85rem 1rem;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: var(--shadow-sm);
            outline: none;
            transition: var(--transition-fast);
        }

        .search-filter-bar .search-input:focus,
        .search-filter-bar .filter-select:focus {
            border-color: var(--primary-light);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.18);
        }

        .search-filter-bar .search-input::placeholder {
            color: var(--gray-600);
        }

        @media (max-width: 600px) {
            .search-filter-bar .search-input,
            .search-filter-bar .filter-select {
                min-width: 100%;
            }
        }

        /* Modern Controls */
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 2.5rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 20px 32px;
            border: none;
            border-radius: var(--radius-xl);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-normal);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            font-size: 1.1rem;
            min-height: 64px;
            flex: 1;
            min-width: 160px;
            max-width: 400px;
            position: relative;
            overflow: hidden;
            letter-spacing: 0.3px;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: var(--transition-normal);
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
            box-shadow: var(--shadow-md), 0 4px 0 rgba(58, 12, 163, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .btn-primary:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg), 0 6px 0 rgba(58, 12, 163, 0.3);
        }

        .btn-primary:active {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md), 0 2px 0 rgba(58, 12, 163, 0.3);
        }

        .btn-secondary {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            color: var(--primary);
            border: 2px solid var(--primary-light);
            box-shadow: var(--shadow-md);
        }
        
        /* New button style for adding/editing */
        .btn-accent {
            background: var(--gradient-accent);
            color: white;
            box-shadow: var(--shadow-md), 0 4px 0 rgba(183, 23, 158, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .btn-accent:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg), 0 6px 0 rgba(183, 23, 158, 0.3);
        }

        .btn-accent:active {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md), 0 2px 0 rgba(183, 23, 158, 0.3);
        }

        .btn-secondary:hover {
            background: var(--primary-light);
            color: white;
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            border-color: transparent;
        }

        .btn i {
            font-size: 1.2rem;
        }
        
        /* Small button style (for edit/delete) */
        .btn-sm {
            padding: 10px 18px;
            min-height: 40px;
            font-size: 0.9rem;
            border-radius: var(--radius-lg);
            flex: none;
            min-width: 100px;
        }
        
        /* Modern View Toggle */
        .view-toggle {
            display: flex;
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-xl);
            padding: 8px;
            margin: 0 auto 3rem;
            width: fit-content;
            box-shadow: var(--shadow-lg);
            max-width: 95%;
            position: relative;
            overflow: hidden;
        }

        .view-toggle::before {
            content: '';
            position: absolute;
            top: 8px;
            left: 8px;
            right: 8px;
            bottom: 8px;
            background: var(--gradient-primary);
            border-radius: var(--radius-lg);
            opacity: 0;
            transition: var(--transition-normal);
            z-index: 0;
        }

        .view-btn {
            padding: 16px 28px;
            border-radius: var(--radius-lg);
            border: none;
            background: none;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-normal);
            font-size: 1.1rem;
            min-height: 56px;
            flex: 1;
            white-space: nowrap;
            color: var(--gray-600);
            position: relative;
            z-index: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .view-btn.active {
            color: white;
            background: var(--gradient-primary);
            box-shadow: var(--shadow-md);
        }

        .view-btn:hover:not(.active) {
            color: var(--primary);
            transform: translateY(-2px);
        }

        /* Modern Grid View */
        .grid-view {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(min(100%, 360px), 1fr));
            gap: 2rem;
            margin-bottom: 4rem;
        }

        .word-card {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            transition: var(--transition-normal);
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
        }

        .word-card:hover {
            transform: translateY(-8px) rotateX(2deg);
            box-shadow: var(--shadow-xl);
        }

        .word-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-primary);
            border-radius: var(--radius-lg) var(--radius-lg) 0 0;
        }

        .word-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 2rem;
            position: relative;
            overflow: hidden;
        }

        .word-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            opacity: 0.5;
        }

        .word-french {
            font-size: clamp(1.8rem, 4vw, 2.2rem);
            font-weight: 700;
            margin-bottom: 8px;
            padding-right: 60px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .word-pos {
            font-size: clamp(0.9rem, 3vw, 1rem);
            opacity: 0.9;
            font-style: italic;
            letter-spacing: 0.5px;
        }

        .word-pronounce-btn {
            position: absolute;
            top: 2rem;
            right: 2rem;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            width: 52px;
            height: 52px;
            color: white;
            cursor: pointer;
            transition: var(--transition-normal);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
        }

        .word-pronounce-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1) rotate(5deg);
        }

        .word-body {
            padding: 2rem;
        }

        .word-translation {
            font-size: clamp(1.5rem, 4vw, 1.8rem);
            color: var(--dark);
            font-weight: 700;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px dashed var(--gray-200);
        }

        .example-container {
            background: linear-gradient(135deg, rgba(67, 97, 238, 0.05) 0%, rgba(114, 9, 183, 0.05) 100%);
            border-radius: var(--radius-sm);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-left: 4px solid var(--primary);
        }

        .example-french-wrapper {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 0.8rem;
        }

        .example-french {
            font-style: italic;
            color: var(--dark);
            line-height: 1.6;
            font-size: clamp(1.05rem, 3vw, 1.1rem);
            flex-grow: 1;
        }

        .pronounce-example-btn {
            background: var(--gradient-accent);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            min-width: 40px;
            cursor: pointer;
            transition: var(--transition-normal);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            flex-shrink: 0;
            margin-top: 2px;
            box-shadow: var(--shadow-sm);
        }

        .pronounce-example-btn:hover {
            transform: scale(1.1) rotate(5deg);
            box-shadow: var(--shadow-md);
        }

        .example-translation {
            color: var(--gray-600);
            line-height: 1.6;
            font-size: clamp(0.95rem, 3vw, 1rem);
            padding-top: 0.8rem;
            border-top: 1px dashed var(--gray-300);
        }

        /* Modern Rating Section */
        .rating-section {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 2px dashed var(--gray-200);
        }

        .rating-label {
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 1rem;
            display: block;
            font-size: clamp(1rem, 3vw, 1.1rem);
            letter-spacing: 0.5px;
        }

        .rating-controls {
            display: flex;
            justify-content: space-between;
            gap: 12px;
            margin-bottom: 0.8rem;
        }

        .rating-btn {
            flex: 1;
            min-width: 50px;
            height: 52px;
            border-radius: var(--radius-sm);
            border: 2px solid var(--gray-200);
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition-normal);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            background: white;
            color: var(--gray-600);
            position: relative;
            overflow: hidden;
        }

        .rating-btn:hover {
            border-color: var(--primary-light);
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
        }

        .rating-btn.active {
            transform: translateY(-4px);
            box-shadow: var(--shadow-md);
            border-color: transparent;
        }

        .rating-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            opacity: 0;
            transition: var(--transition-normal);
        }

        .rating-btn.active::before {
            opacity: 1;
        }

        /* Rating Colors */
        .rating-1.active {
            background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
            color: white;
        }
        .rating-2.active {
            background: linear-gradient(135deg, #ff9e6d, #ffb88c);
            color: white;
        }
        .rating-3.active {
            background: linear-gradient(135deg, #ffd166, #ffe0a3);
            color: var(--dark);
        }
        .rating-4.active {
            background: linear-gradient(135deg, #06d6a0, #0ce9b0);
            color: white;
        }
        .rating-5.active {
            background: linear-gradient(135deg, #118ab2, #1ba0d3);
            color: white;
        }

        .rating-text {
            font-size: clamp(0.85rem, 3vw, 0.9rem);
            color: var(--gray-600);
            text-align: center;
            margin-top: 0.5rem;
            font-weight: 500;
        }

        /* Edit/Delete Controls on Card */
        .card-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px dashed var(--gray-200);
        }
        
        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 1000;
            display: none; /* Controlled by JS */
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-lg);
            padding: 2.5rem;
            width: 100%;
            max-width: 600px;
            box-shadow: var(--shadow-xl);
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-content h2 {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 2rem;
            color: var(--primary);
            border-bottom: 3px solid var(--primary-light);
            padding-bottom: 10px;
        }

        .modal-form label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            margin-top: 15px;
            color: var(--dark);
        }

        .modal-form input, .modal-form textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--gray-300);
            border-radius: var(--radius-sm);
            font-size: 1rem;
            transition: var(--transition-fast);
            background: var(--gray-100);
            color: var(--dark);
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
            resize: vertical;
        }

        .modal-form input:focus, .modal-form textarea:focus {
            border-color: var(--primary-light);
            outline: none;
            background: white;
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }

        .modal-actions {
            display: flex;
            justify-content: space-between;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .modal-actions .btn {
            flex: 1;
            min-width: 150px;
        }
        
        .modal-close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--gray-600);
            cursor: pointer;
            transition: var(--transition-normal);
        }

        .modal-close-btn:hover {
            color: var(--error);
            transform: rotate(90deg);
        }
        
        /* MODERN QUIZ VIEW - Enhanced Design */
        .quiz-view {
            display: none;
            max-width: 800px;
            margin: 0 auto 3rem;
        }

        .quiz-card {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-lg);
            padding: 3rem;
            box-shadow: var(--shadow-xl);
            margin-bottom: 2.5rem;
            position: relative;
            overflow: hidden;
        }

        .quiz-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: var(--gradient-primary);
        }

        .quiz-question {
            font-size: clamp(1.8rem, 5vw, 2.2rem);
            margin-bottom: 2rem;
            color: var(--dark);
            line-height: 1.4;
            text-align: center;
            font-weight: 700;
            background: linear-gradient(135deg, var(--dark) 0%, var(--gray-800) 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .quiz-word {
            font-weight: 800;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            display: inline-block;
            word-break: break-word;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 0 5px;
            position: relative;
        }

        .quiz-word::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 5px;
            right: 5px;
            height: 3px;
            background: var(--gradient-primary);
            border-radius: 2px;
            opacity: 0.5;
        }

        .quiz-options {
            display: grid;
            grid-template-columns: 1fr;
            gap: 16px;
            margin-bottom: 2rem;
        }

        .quiz-option {
            padding: 22px 20px;
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition-normal);
            text-align: center;
            font-weight: 600;
            font-size: 1.2rem;
            min-height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            word-break: break-word;
            background: white;
            box-shadow: var(--shadow-sm);
            position: relative;
            overflow: hidden;
        }

        .quiz-option::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 0;
            background: var(--gradient-primary);
            transition: var(--transition-normal);
            z-index: 0;
        }

        .quiz-option:hover {
            border-color: var(--primary-light);
            transform: translateY(-4px);
            box-shadow: var(--shadow-md);
        }

        .quiz-option:hover::before {
            width: 5px;
        }

        .quiz-option.correct {
            border-color: #06d6a0;
            background: linear-gradient(135deg, rgba(6, 214, 160, 0.1) 0%, rgba(6, 214, 160, 0.05) 100%);
            color: #06d6a0;
            transform: scale(1.02);
            box-shadow: var(--shadow-md);
        }

        .quiz-option.correct::before {
            width: 8px;
            background: #06d6a0;
        }

        .quiz-option.wrong {
            border-color: #f72585;
            background: linear-gradient(135deg, rgba(247, 37, 133, 0.1) 0%, rgba(247, 37, 133, 0.05) 100%);
            color: #f72585;
        }

        .quiz-option.wrong::before {
            width: 8px;
            background: #f72585;
        }

        .quiz-feedback {
            padding: 2rem;
            background: linear-gradient(135deg, rgba(67, 97, 238, 0.05) 0%, rgba(114, 9, 183, 0.05) 100%);
            border-radius: var(--radius-md);
            margin-top: 2rem;
            display: none;
            border-left: 5px solid var(--primary);
            box-shadow: var(--shadow-sm);
            animation: slideIn 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .quiz-feedback.show {
            display: block;
        }

        .feedback-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .feedback-text {
            font-size: 1.1rem;
            line-height: 1.6;
        }

        .feedback-text strong {
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 700;
        }

        /* Modern Progress Container */
        .progress-container {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-lg);
            padding: 2rem;
            box-shadow: var(--shadow-xl);
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
        }

        .progress-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-primary);
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            font-weight: 700;
            font-size: clamp(1.1rem, 3vw, 1.3rem);
            flex-wrap: wrap;
            gap: 15px;
            color: var(--dark);
        }

        .progress-bar {
            height: 16px;
            background: var(--gray-200);
            border-radius: 10px;
            margin: 1.5rem 0;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        .progress-fill {
            height: 100%;
            background: var(--gradient-primary);
            border-radius: 10px;
            width: 0%;
            transition: width 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.3) 50%, transparent 100%);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% {
                transform: translateX(-100%);
            }
            100% {
                transform: translateX(100%);
            }
        }

        .score-display {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 24px;
            background: var(--gradient-primary);
            color: white;
            border-radius: var(--radius-xl);
            font-size: 1.2rem;
            font-weight: 700;
            box-shadow: var(--shadow-md);
        }

        /* Footer Styles */
        footer {
            text-align: center;
            padding: 2rem 0;
            margin-top: 2rem;
            color: var(--gray-600);
            font-size: 0.9rem;
            border-top: 1px solid var(--gray-200);
            background: var(--gray-100);
        }

        footer p {
            margin: 0.5rem 0;
        }
        
        /* Mobile Optimizations */
        @media (max-width: 768px) {
            .view-toggle {
                padding: 5px;
                border-radius: var(--radius-md);
            }
            .view-btn {
                padding: 14px 16px;
                font-size: 1rem;
            }
            .quiz-card {
                padding: 2rem;
            }
            .quiz-question {
                font-size: 1.6rem;
                margin-bottom: 1.8rem;
            }
            .rating-controls {
                gap: 10px;
            }
            .rating-btn {
                min-width: 46px;
                height: 48px;
                font-size: 1rem;
            }
            .word-pronounce-btn {
                width: 48px;
                height: 48px;
                top: 1.5rem;
                right: 1.5rem;
                font-size: 1.2rem;
            }
            .pronounce-example-btn {
                width: 36px;
                height: 36px;
                min-width: 36px;
                font-size: 0.9rem;
            }
            .progress-container {
                padding: 1.5rem;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 0 14px;
            }
            .stats-bar {
                grid-template-columns: 1fr;
                gap: 20px;
                padding: 1.2rem;
            }
            .stat-number {
                font-size: 2.2rem;
            }
            .stat-label {
                font-size: 0.9rem;
            }
            header h1 {
                font-size: 2rem;
            }
            .btn {
                padding: 16px 20px;
                min-height: 56px;
                font-size: 1rem;
            }
            .word-header {
                padding: 1.5rem;
            }
            .word-body {
                padding: 1.5rem;
            }
            .word-french {
                padding-right: 50px;
            }
            .word-pronounce-btn {
                top: 1.5rem;
                right: 1.5rem;
            }
            .modal-content {
                padding: 2rem 1.5rem;
            }
            .modal-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1><i class="fas fa-graduation-cap"></i>French Words For Wan-Chun</h1>
            <p>Your personal collection of French words to learn and master.</p>
        </div>
    </header>
    <div class="container">
        
        <div class="stats-bar">
            <div class="stat-item">
                <div class="stat-number" id="total-words-stat">0</div>
                <div class="stat-label">Total Words</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="mastered-words-stat">0</div>
                <div class="stat-label">Mastered (Rate 5)</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="quiz-accuracy-stat">0%</div>
                <div class="stat-label">Quiz Accuracy</div>
            </div>
        </div>

        <!-- Search & Filter Bar -->
        <div class="search-filter-bar">
            <input
                id="search-input"
                class="search-input"
                type="text"
                placeholder="Search by French word, translation, or example..."
                autocomplete="off"
            />
            <select id="category-filter" class="filter-select">
                <option value="all">All categories</option>
            </select>
        </div>

        <div class="controls">
            <button class="btn btn-accent" id="add-new-word">
                <i class="fas fa-plus-circle"></i> Add New Word
            </button>
            <button class="btn btn-primary" id="start-quiz">
                <i class="fas fa-question-circle"></i> Start Quiz (All Words)
            </button>
             <button class="btn btn-primary btn-secondary" id="practice-mastered">
                <i class="fas fa-redo-alt"></i> Practice Mastered
            </button>
        </div>
        
        <div class="view-toggle">
            <button class="view-btn active" id="grid-view-btn">
                <i class="fas fa-th-large"></i> Card View
            </button>
            <button class="view-btn" id="quiz-view-btn">
                <i class="fas fa-dumbbell"></i> Practice Quiz
            </button>
        </div>

        <div class="grid-view" id="grid-view">
            </div>

        <div class="quiz-view" id="quiz-view">
            <div class="progress-container">
                <div class="progress-info">
                    <span>Question <span id="current-question">0</span> of <span id="total-questions">0</span></span>
                    <div class="score-display"><i class="fas fa-check-circle"></i> Score: <span id="quiz-score">0/0</span></div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="quiz-progress"></div>
                </div>
            </div>
            
            <div class="quiz-card">
                </div>
            
            <div class="quiz-completion-container" id="quiz-completion-screen" style="display: none;">
                </div>
        </div>

    </div>

    <div class="modal-overlay" id="word-modal-overlay">
        <div class="modal-content">
            <button class="modal-close-btn" id="modal-close-btn"><i class="fas fa-times"></i></button>
            <h2 id="modal-title">Add New Word</h2>
            <form id="word-form" class="modal-form">
                <input type="hidden" id="word-index">
                <label for="french-word">French Word:</label>
                <input type="text" id="french-word" required>
                <label for="word-pos">Part of Speech (e.g., noun (fem), verb, phrase):</label>
                <input type="text" id="word-pos" required>
                <label for="word-translation">English Translation:</label>
                <input type="text" id="word-translation" required>
                <label for="example-french">Example Sentence (French):</label>
                <textarea id="example-french" rows="2" required></textarea>
                <label for="example-translation">Example Translation (English):</label>
                <textarea id="example-translation" rows="2" required></textarea>
                <div class="modal-actions">
                    <button type="submit" class="btn btn-primary" id="modal-save-btn">
                        <i class="fas fa-save"></i> Save Word
                    </button>
                    <button type="button" class="btn btn-secondary" id="modal-cancel-btn">
                        Cancel
                    </button>
                    <button type="button" class="btn btn-accent btn-sm" id="modal-delete-btn" style="display: none; background: #dc3545; box-shadow: var(--shadow-md), 0 4px 0 rgba(175, 20, 42, 0.3);">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                </div>
            </form>
        </div>
    </div>

    <footer>
        <p>Built with <i class="fas fa-heart" style="color: var(--error);"></i></p>
        <p>This application now supports adding and editing your own custom vocabulary entries.</p>
    </footer>
    
    <audio id="audio-player" class="audio-player" src="" preload="auto"></audio> 
    
    <script>
        // --- DEFAULT VOCABULARY (Used if no custom data is found in localStorage) ---
        const DEFAULT_FRENCH_WORDS = [
                                      
                                          // --- 更多动词 ---
                                          { french: "manger", pos: "verb", translation: "to eat", example: "Nous mangeons au restaurant ce soir.", exampleTranslation: "We are eating at the restaurant tonight.", rating: 0 },
                                          { french: "boire", pos: "verb", translation: "to drink", example: "Je bois de l'eau tous les jours.", exampleTranslation: "I drink water every day.", rating: 0 },
                                          { french: "dormir", pos: "verb", translation: "to sleep", example: "Les enfants dorment tôt.", exampleTranslation: "The children sleep early.", rating: 0 },
                                          { french: "parler", pos: "verb", translation: "to speak", example: "Elle parle français couramment.", exampleTranslation: "She speaks French fluently.", rating: 0 },
                                          { french: "écrire", pos: "verb", translation: "to write", example: "J'écris une lettre à mon ami.", exampleTranslation: "I am writing a letter to my friend.", rating: 0 },
                                          { french: "lire", pos: "verb", translation: "to read", example: "Il lit le journal chaque matin.", exampleTranslation: "He reads the newspaper every morning.", rating: 0 },
                                          { french: "apprendre", pos: "verb", translation: "to learn", example: "J'apprends le français depuis un an.", exampleTranslation: "I have been learning French for a year.", rating: 0 },
                                          { french: "comprendre", pos: "verb", translation: "to understand", example: "Je comprends la leçon maintenant.", exampleTranslation: "I understand the lesson now.", rating: 0 },
                                          { french: "penser", pos: "verb", translation: "to think", example: "Je pense que c'est une bonne idée.", exampleTranslation: "I think it's a good idea.", rating: 0 },
                                          { french: "acheter", pos: "verb", translation: "to buy", example: "Elle achète des fruits au marché.", exampleTranslation: "She buys fruits at the market.", rating: 0 },

                                          // --- 更多形容词 ---
                                          { french: "beau", pos: "adjective (masc)", translation: "beautiful/handsome", example: "C'est un beau paysage.", exampleTranslation: "It's a beautiful landscape.", rating: 0 },
                                          { french: "belle", pos: "adjective (fem)", translation: "beautiful", example: "Elle porte une belle robe.", exampleTranslation: "She is wearing a beautiful dress.", rating: 0 },
                                          { french: "jeune", pos: "adjective", translation: "young", example: "Les jeunes étudiants étudient dur.", exampleTranslation: "The young students study hard.", rating: 0 },
                                          { french: "vieux", pos: "adjective (masc)", translation: "old", example: "Le vieil homme raconte des histoires.", exampleTranslation: "The old man tells stories.", rating: 0 },
                                          { french: "nouvelle", pos: "adjective (fem)", translation: "new", example: "C'est une nouvelle voiture.", exampleTranslation: "It's a new car.", rating: 0 },
                                          { french: "facile", pos: "adjective", translation: "easy", example: "Cet exercice est facile.", exampleTranslation: "This exercise is easy.", rating: 0 },
                                          { french: "difficile", pos: "adjective", translation: "difficult", example: "L'examen était difficile.", exampleTranslation: "The exam was difficult.", rating: 0 },
                                          { french: "heureux", pos: "adjective (masc)", translation: "happy", example: "Je suis heureux de te voir.", exampleTranslation: "I am happy to see you.", rating: 0 },
                                          { french: "triste", pos: "adjective", translation: "sad", example: "Elle est triste à cause de la nouvelle.", exampleTranslation: "She is sad because of the news.", rating: 0 },
                                          { french: "fatigué", pos: "adjective (masc)", translation: "tired", example: "Je suis fatigué après le travail.", exampleTranslation: "I am tired after work.", rating: 0 },

                                          // --- 更多名词 ---
                                          { french: "école", pos: "noun (fem)", translation: "school", example: "Les enfants vont à l'école.", exampleTranslation: "The children go to school.", rating: 0 },
                                          { french: "université", pos: "noun (fem)", translation: "university", example: "Il étudie à l'université de Paris.", exampleTranslation: "He studies at the University of Paris.", rating: 0 },
                                          { french: "hôpital", pos: "noun (masc)", translation: "hospital", example: "Elle travaille à l'hôpital.", exampleTranslation: "She works at the hospital.", rating: 0 },
                                          { french: "restaurant", pos: "noun (masc)", translation: "restaurant", example: "Nous dînons au restaurant italien.", exampleTranslation: "We are having dinner at the Italian restaurant.", rating: 0 },
                                          { french: "cinéma", pos: "noun (masc)", translation: "cinema", example: "Allons au cinéma ce soir.", exampleTranslation: "Let's go to the cinema tonight.", rating: 0 },
                                          { french: "musée", pos: "noun (masc)", translation: "museum", example: "Le musée du Louvre est célèbre.", exampleTranslation: "The Louvre Museum is famous.", rating: 0 },
                                          { french: "parc", pos: "noun (masc)", translation: "park", example: "Les enfants jouent dans le parc.", exampleTranslation: "The children play in the park.", rating: 0 },
                                          { french: "plage", pos: "noun (fem)", translation: "beach", example: "En été, nous allons à la plage.", exampleTranslation: "In summer, we go to the beach.", rating: 0 },
                                          { french: "montagne", pos: "noun (fem)", translation: "mountain", example: "Ils font de l'escalade en montagne.", exampleTranslation: "They go climbing in the mountains.", rating: 0 },
                                          { french: "fleur", pos: "noun (fem)", translation: "flower", example: "Elle a reçu de belles fleurs.", exampleTranslation: "She received beautiful flowers.", rating: 0 },

                                          // --- 天气相关 ---
                                          { french: "soleil", pos: "noun (masc)", translation: "sun", example: "Le soleil brille aujourd'hui.", exampleTranslation: "The sun is shining today.", rating: 0 },
                                          { french: "pluie", pos: "noun (fem)", translation: "rain", example: "Prends un parapluie, il va pleuvoir.", exampleTranslation: "Take an umbrella, it's going to rain.", rating: 0 },
                                          { french: "neige", pos: "noun (fem)", translation: "snow", example: "Les enfants aiment jouer dans la neige.", exampleTranslation: "Children love playing in the snow.", rating: 0 },
                                          { french: "vent", pos: "noun (masc)", translation: "wind", example: "Le vent est fort aujourd'hui.", exampleTranslation: "The wind is strong today.", rating: 0 },
                                          { french: "nuage", pos: "noun (masc)", translation: "cloud", example: "Le ciel est plein de nuages.", exampleTranslation: "The sky is full of clouds.", rating: 0 },

                                          // --- 颜色 ---
                                          { french: "rouge", pos: "adjective", translation: "red", example: "La pomme est rouge.", exampleTranslation: "The apple is red.", rating: 0 },
                                          { french: "bleu", pos: "adjective (masc)", translation: "blue", example: "Le ciel est bleu.", exampleTranslation: "The sky is blue.", rating: 0 },
                                          { french: "vert", pos: "adjective (masc)", translation: "green", example: "L'herbe est verte.", exampleTranslation: "The grass is green.", rating: 0 },
                                          { french: "jaune", pos: "adjective", translation: "yellow", example: "Le soleil est jaune.", exampleTranslation: "The sun is yellow.", rating: 0 },
                                          { french: "noir", pos: "adjective (masc)", translation: "black", example: "La nuit est noire.", exampleTranslation: "The night is black.", rating: 0 },
                                          { french: "blanc", pos: "adjective (masc)", translation: "white", example: "La neige est blanche.", exampleTranslation: "The snow is white.", rating: 0 },

                                          // --- 数字 (1-10) ---
                                          { french: "un", pos: "number (masc)", translation: "one", example: "J'ai un frère.", exampleTranslation: "I have one brother.", rating: 0 },
                                          { french: "deux", pos: "number", translation: "two", example: "Il y a deux chats dans le jardin.", exampleTranslation: "There are two cats in the garden.", rating: 0 },
                                          { french: "trois", pos: "number", translation: "three", example: "Nous sommes trois personnes.", exampleTranslation: "There are three of us.", rating: 0 },
                                          { french: "quatre", pos: "number", translation: "four", example: "Les quatre saisons de l'année.", exampleTranslation: "The four seasons of the year.", rating: 0 },
                                          { french: "cinq", pos: "number", translation: "five", example: "J'ai cinq doigts à chaque main.", exampleTranslation: "I have five fingers on each hand.", rating: 0 },
                                          { french: "six", pos: "number", translation: "six", example: "Une demi-douzaine fait six.", exampleTranslation: "A half dozen makes six.", rating: 0 },
                                          { french: "sept", pos: "number", translation: "seven", example: "La semaine a sept jours.", exampleTranslation: "The week has seven days.", rating: 0 },
                                          { french: "huit", pos: "number", translation: "eight", example: "Une araignée a huit pattes.", exampleTranslation: "A spider has eight legs.", rating: 0 },
                                          { french: "neuf", pos: "number", translation: "nine", example: "Le chat a neuf vies.", exampleTranslation: "A cat has nine lives.", rating: 0 },
                                          { french: "dix", pos: "number", translation: "ten", example: "Il est dix heures du matin.", exampleTranslation: "It's ten o'clock in the morning.", rating: 0 },

                                          // --- 更多介词和副词 ---
                                          { french: "avant", pos: "preposition", translation: "before", example: "Avant de partir, ferme la porte.", exampleTranslation: "Before leaving, close the door.", rating: 0 },
                                          { french: "après", pos: "preposition", translation: "after", example: "Après le dîner, nous regardons un film.", exampleTranslation: "After dinner, we watch a movie.", rating: 0 },
                                          { french: "pendant", pos: "preposition", translation: "during", example: "Pendant l'été, il fait chaud.", exampleTranslation: "During summer, it is hot.", rating: 0 },
                                          { french: "maintenant", pos: "adverb", translation: "now", example: "Je suis occupé maintenant.", exampleTranslation: "I am busy now.", rating: 0 },
                                          { french: "toujours", pos: "adverb", translation: "always", example: "Il est toujours à l'heure.", exampleTranslation: "He is always on time.", rating: 0 },
                                          { french: "souvent", pos: "adverb", translation: "often", example: "Nous allons souvent au cinéma.", exampleTranslation: "We often go to the cinema.", rating: 0 },
                                          { french: "rarement", pos: "adverb", translation: "rarely", example: "Il pleut rarement dans le désert.", exampleTranslation: "It rarely rains in the desert.", rating: 0 },
                                          { french: "vite", pos: "adverb", translation: "quickly", example: "Il court vite.", exampleTranslation: "He runs quickly.", rating: 0 },
                                          { french: "lentement", pos: "adverb", translation: "slowly", example: "Parlez lentement, s'il vous plaît.", exampleTranslation: "Please speak slowly.", rating: 0 },

                                          // --- 更多常用短语 ---
                                          { french: "Je ne comprends pas.", pos: "phrase", translation: "I don't understand.", example: "Je ne comprends pas cette phrase.", exampleTranslation: "I don't understand this sentence.", rating: 0 },
                                          { french: "Pouvez-vous répéter?", pos: "phrase", translation: "Can you repeat?", example: "Pouvez-vous répéter la question?", exampleTranslation: "Can you repeat the question?", rating: 0 },
                                          { french: "Parlez-vous anglais?", pos: "phrase", translation: "Do you speak English?", example: "Excusez-moi, parlez-vous anglais?", exampleTranslation: "Excuse me, do you speak English?", rating: 0 },
                                          { french: "Où est...?", pos: "phrase", translation: "Where is...?", example: "Où est la gare?", exampleTranslation: "Where is the train station?", rating: 0 },
                                          { french: "Combien ça coûte?", pos: "phrase", translation: "How much does it cost?", example: "Combien ça coûte, s'il vous plaît?", exampleTranslation: "How much does it cost, please?", rating: 0 },
                                          { french: "J'ai faim.", pos: "phrase", translation: "I'm hungry.", example: "J'ai faim, allons manger.", exampleTranslation: "I'm hungry, let's eat.", rating: 0 },
                                          { french: "J'ai soif.", pos: "phrase", translation: "I'm thirsty.", example: "J'ai soif, je veux de l'eau.", exampleTranslation: "I'm thirsty, I want some water.", rating: 0 },
                                          { french: "Je suis perdu.", pos: "phrase", translation: "I'm lost.", example: "Excusez-moi, je suis perdu.", exampleTranslation: "Excuse me, I'm lost.", rating: 0 },
                                          { french: "À quelle heure?", pos: "phrase", translation: "At what time?", example: "À quelle heure commence le film?", exampleTranslation: "At what time does the movie start?", rating: 0 },
                                          { french: "C'est combien?", pos: "phrase", translation: "How much is it?", example: "C'est combien pour ce livre?", exampleTranslation: "How much is it for this book?", rating: 0 },

                                          // --- 家庭成员 ---
                                          { french: "père", pos: "noun (masc)", translation: "father", example: "Mon père est médecin.", exampleTranslation: "My father is a doctor.", rating: 0 },
                                          { french: "mère", pos: "noun (fem)", translation: "mother", example: "Ma mère cuisine bien.", exampleTranslation: "My mother cooks well.", rating: 0 },
                                          { french: "frère", pos: "noun (masc)", translation: "brother", example: "Mon frère est plus jeune que moi.", exampleTranslation: "My brother is younger than me.", rating: 0 },
                                          { french: "sœur", pos: "noun (fem)", translation: "sister", example: "Ma sœur étudie à l'université.", exampleTranslation: "My sister studies at university.", rating: 0 },
                                          { french: "fils", pos: "noun (masc)", translation: "son", example: "Leur fils a cinq ans.", exampleTranslation: "Their son is five years old.", rating: 0 },
                                          { french: "fille", pos: "noun (fem)", translation: "daughter", example: "Leur fille joue du piano.", exampleTranslation: "Their daughter plays the piano.", rating: 0 },

                                          // --- 更多食物 ---
                                          { french: "fromage", pos: "noun (masc)", translation: "cheese", example: "Le fromage français est célèbre.", exampleTranslation: "French cheese is famous.", rating: 0 },
                                          { french: "beurre", pos: "noun (masc)", translation: "butter", example: "Je mets du beurre sur mon pain.", exampleTranslation: "I put butter on my bread.", rating: 0 },
                                          { french: "lait", pos: "noun (masc)", translation: "milk", example: "Les enfants boivent du lait.", exampleTranslation: "Children drink milk.", rating: 0 },
                                          { french: "œuf", pos: "noun (masc)", translation: "egg", example: "Je mange un œuf chaque matin.", exampleTranslation: "I eat an egg every morning.", rating: 0 },
                                          { french: "légume", pos: "noun (masc)", translation: "vegetable", example: "Mangez des légumes pour être en bonne santé.", exampleTranslation: "Eat vegetables to be healthy.", rating: 0 },

                                          // --- 交通 ---
                                          { french: "train", pos: "noun (masc)", translation: "train", example: "Le train arrive à 14 heures.", exampleTranslation: "The train arrives at 2 PM.", rating: 0 },
                                          { french: "bus", pos: "noun (masc)", translation: "bus", example: "Je prends le bus pour aller au travail.", exampleTranslation: "I take the bus to go to work.", rating: 0 },
                                          { french: "avion", pos: "noun (masc)", translation: "airplane", example: "L'avion décolle dans une heure.", exampleTranslation: "The airplane takes off in one hour.", rating: 0 },
                                          { french: "vélo", pos: "noun (masc)", translation: "bicycle", example: "Je fais du vélo le week-end.", exampleTranslation: "I ride my bicycle on weekends.", rating: 0 },
                                          { french: "métro", pos: "noun (masc)", translation: "subway", example: "Le métro est rapide à Paris.", exampleTranslation: "The subway is fast in Paris.", rating: 0 },

                                          // --- 情感和感受 ---
                                          { french: "amour", pos: "noun (masc)", translation: "love", example: "L'amour est beau.", exampleTranslation: "Love is beautiful.", rating: 0 },
                                          { french: "peur", pos: "noun (fem)", translation: "fear", example: "J'ai peur du noir.", exampleTranslation: "I'm afraid of the dark.", rating: 0 },
                                          { french: "joie", pos: "noun (fem)", translation: "joy", example: "Son succès lui apporte de la joie.", exampleTranslation: "His success brings him joy.", rating: 0 },
                                          { french: "colère", pos: "noun (fem)", translation: "anger", example: "Il montre sa colère.", exampleTranslation: "He shows his anger.", rating: 0 },
                                          { french: "espoir", pos: "noun (masc)", translation: "hope", example: "Ne perdez pas espoir.", exampleTranslation: "Don't lose hope.", rating: 0 },
                                      
            // Time Words from page 1
            { french: "seconde", pos: "noun (fem)", translation: "second", example: "Il reste cinquante-huit secondes au chronomètre.", exampleTranslation: "There are fifty-eight seconds left on the timer.", rating: 0 },
            { french: "minute", pos: "noun (fem)", translation: "minute", example: "Je serai là dans une minute.", exampleTranslation: "I'll be there in a minute.", rating: 0 },
            { french: "heure", pos: "noun (fem)", translation: "hour", example: "L'avion arrivera dans une heure.", exampleTranslation: "The plane will arrive in an hour.", rating: 0 },
            { french: "jour", pos: "noun (masc)", translation: "day", example: "Nous nous voyons tous les jours.", exampleTranslation: "We see each other every day.", rating: 0 },
            { french: "semaine", pos: "noun (fem)", translation: "week", example: "Il pleut toute la semaine.", exampleTranslation: "It's raining all week.", rating: 0 },
            { french: "mois", pos: "noun (masc)", translation: "month", example: "Le mois prochain, je serai en vacances.", exampleTranslation: "Next month I'll be on vacation.", rating: 0 },
            { french: "année", pos: "noun (fem)", translation: "year", example: "Elle a fêté son trentième anniversaire l'année dernière.", exampleTranslation: "She celebrated her thirtieth birthday last year.", rating: 0 },
            // Action Verbs from page 1
            { french: "aller", pos: "verb", translation: "to go", example: "Ils vont au cinéma.", exampleTranslation: "They go to the movies.", rating: 0 },
            { french: "venir", pos: "verb", translation: "to come", example: "Il vient d'arriver.", exampleTranslation: "He has just arrived.", rating: 0 },
            { french: "prendre", pos: "verb", translation: "to take", example: "prendre une photo de la caméra.", exampleTranslation: "to take a photo of the camera.", rating: 0 },
            { french: "rire", pos: "verb", translation: "to laugh", example: "Le couple rit de la plaisanterie.", exampleTranslation: "The couple laughs at the joke.", rating: 0 },
            { french: "faire", pos: "verb", translation: "to make", example: "Le chef fait du jus d'orange.", exampleTranslation: "The chef makes orange juice.", rating: 0 },
            { french: "aimer", pos: "verb", translation: "to like / to love", example: "J'aime faire du vélo.", exampleTranslation: "I like to ride a bike.", rating: 0 },
            { french: "voir", pos: "verb", translation: "to see", example: "voir le film", exampleTranslation: "to see the movie", rating: 0 },
            { french: "entendre", pos: "verb", translation: "to hear", example: "entendre la radio", exampleTranslation: "to hear the radio", rating: 0 },
            { french: "savoir", pos: "verb", translation: "to know (a fact)", example: "savoir cuisiner", exampleTranslation: "to know how to cook", rating: 0 },
            { french: "regarder", pos: "verb", translation: "to watch", example: "regarder le soleil se coucher", exampleTranslation: "to watch the sunset", rating: 0 },
            { french: "ouvrir", pos: "verb", translation: "to open", example: "ouvrir la porte", exampleTranslation: "to open the door", rating: 0 },
            { french: "fermer", pos: "verb", translation: "to close", example: "fermer un livre", exampleTranslation: "to close a book", rating: 0 },
            { french: "demander", pos: "verb", translation: "to ask", example: "demander des informations", exampleTranslation: "to ask for information", rating: 0 },
            { french: "dire", pos: "verb", translation: "to say / to tell", example: "Il dit que le ciel est bleu.", exampleTranslation: "He says the sky is blue.", rating: 0 },
            // Descriptive words from page 2
            { french: "grand", pos: "adjective (masc)", translation: "big / tall", example: "Le grand bâtiment est très haut.", exampleTranslation: "The tall building is very high.", rating: 0 },
            { french: "petit", pos: "adjective (masc)", translation: "small / little", example: "Le petit chat joue.", exampleTranslation: "The little cat is playing.", rating: 0 },
            { french: "bon", pos: "adjective (masc)", translation: "good", example: "Ce livre est très bon.", exampleTranslation: "This book is very good.", rating: 0 },
            { french: "mauvais", pos: "adjective (masc)", translation: "bad", example: "La mauvaise météo arrive.", exampleTranslation: "The bad weather is coming.", rating: 0 },
            { french: "chaud", pos: "adjective (masc)", translation: "hot", example: "Il fait chaud aujourd'hui.", exampleTranslation: "It's hot today.", rating: 0 },
            { french: "froid", pos: "adjective (masc)", translation: "cold", example: "Boire un café froid.", exampleTranslation: "to drink a cold coffee", rating: 0 },
            { french: "vrai", pos: "adjective (masc)", translation: "true / real", example: "La déclaration est vraie.", exampleTranslation: "The statement is true.", rating: 0 },
            { french: "faux", pos: "adjective (masc)", translation: "false", example: "La réponse est fausse.", exampleTranslation: "The answer is false.", rating: 0 },
            { french: "nouveau", pos: "adjective (masc)", translation: "new", example: "Il a une nouvelle voiture.", exampleTranslation: "He has a new car.", rating: 0 },
            { french: "vieux", pos: "adjective (masc)", translation: "old", example: "Le vieux livre est poussiéreux.", exampleTranslation: "The old book is dusty.", rating: 0 },
            // Prepositions/Adverbs from page 2
            { french: "avec", pos: "preposition", translation: "with", example: "Je marche avec mon chien.", exampleTranslation: "I walk with my dog.", rating: 0 },
            { french: "sans", pos: "preposition", translation: "without", example: "Il est sans argent.", exampleTranslation: "He is without money.", rating: 0 },
            { french: "sur", pos: "preposition", translation: "on", example: "Le livre est sur la table.", exampleTranslation: "The book is on the table.", rating: 0 },
            { french: "sous", pos: "preposition", translation: "under", example: "Le chat est sous le lit.", exampleTranslation: "The cat is under the bed.", rating: 0 },
            { french: "demain", pos: "adverb", translation: "tomorrow", example: "Il y aura peut-être du mauvais temps demain.", exampleTranslation: "There might be bad weather tomorrow.", rating: 0 },
            { french: "près de", pos: "adjective", translation: "near", example: "La pomme est près de l'orange.", exampleTranslation: "The apple is near the orange.", rating: 0 },
            // Phrases from page 2
            { french: "Enchanté de vous rencontrer.", pos: "phrase", translation: "Nice to meet you.", example: "Enchanté de vous rencontrer, Monsieur.", exampleTranslation: "Nice to meet you, sir.", rating: 0 },
            { french: "Bonjour.", pos: "noun", translation: "Hello.", example: "Quand je rencontre une personne pour la première fois, je dis \"Bonjour\".", exampleTranslation: "When I meet a person for the first time, je dis \"Hello\".", rating: 0 },
            { french: "Bon après-midi.", pos: "phrase", translation: "Good afternoon.", example: "Bon après-midi.", exampleTranslation: "Good afternoon.", rating: 0 },
            { french: "Bonsoir.", pos: "noun", translation: "Good evening.", example: "Bonsoir, Madame.", exampleTranslation: "Good evening, Madam.", rating: 0 },
            { french: "Au revoir.", pos: "phrase", translation: "Goodbye.", example: "Je dis au revoir à mes amis.", exampleTranslation: "I say goodbye to my friends.", rating: 0 },
            { french: "Merci.", pos: "noun", translation: "Thank you.", example: "Merci pour le cadeau.", exampleTranslation: "Thank you for the gift.", rating: 0 },
            { french: "S'il vous plaît.", pos: "phrase", translation: "Please.", example: "Passez-moi le sel, s'il vous plaît.", exampleTranslation: "Pass me the salt, please.", rating: 0 },
            { french: "Comment allez-vous?", pos: "phrase", translation: "How are you?", example: "Comment allez-vous?", exampleTranslation: "How are you?", rating: 0 },
            { french: "Je vais bien.", pos: "phrase", translation: "I am well.", example: "Je vais bien, merci.", exampleTranslation: "I am well, thank you.", rating: 0 },
            { french: "Excusez-moi.", pos: "phrase", translation: "Excuse me.", example: "Excusez-moi, où sont les toilettes?", exampleTranslation: "Excuse me, where is the restroom?", rating: 0 },
            // Nouns/Objects from page 3
            { french: "ordinateur", pos: "noun (masc)", translation: "computer", example: "utiliser un ordinateur", exampleTranslation: "to use a computer", rating: 0 },
            { french: "téléphone", pos: "noun (masc)", translation: "phone", example: "téléphoner à mes parents", exampleTranslation: "to phone my parents", rating: 0 },
            { french: "livre", pos: "noun (masc)", translation: "book", example: "lire un livre", exampleTranslation: "to read a book", rating: 0 },
            { french: "maison", pos: "noun (fem)", translation: "house", example: "rentrer à la maison", exampleTranslation: "to go home", rating: 0 },
            { french: "voiture", pos: "noun (fem)", translation: "car", example: "acheter une voiture", exampleTranslation: "to buy a car", rating: 0 },
            { french: "argent", pos: "noun (masc)", translation: "money", example: "avoir beaucoup d'argent", exampleTranslation: "to have a lot of money", rating: 0 },
            { french: "travail", pos: "noun (masc)", translation: "work / job", example: "aller au travail", exampleTranslation: "to go to work", rating: 0 },
            { french: "famille", pos: "noun (fem)", translation: "family", example: "avoir une grande famille", exampleTranslation: "to have a big family", rating: 0 },
            { french: "enfant", pos: "noun (masc/fem)", translation: "child", example: "un enfant de 5 ans", exampleTranslation: "a 5 year old child", rating: 0 },
            { french: "ami", pos: "noun (masc)", translation: "friend (male)", example: "Mon ami est gentil.", exampleTranslation: "My friend is kind.", rating: 0 },
            { french: "amie", pos: "noun (fem)", translation: "friend (female)", example: "Mon amie est gentille.", exampleTranslation: "My friend is kind.", rating: 0 },
            // Drinks from page 4
            { french: "café", pos: "noun (masc)", translation: "coffee", example: "boire un café", exampleTranslation: "to drink a coffee", rating: 0 },
            { french: "thé", pos: "noun (masc)", translation: "tea", example: "tasse de thé", exampleTranslation: "cup of tea", rating: 0 },
            { french: "vin", pos: "noun (masc)", translation: "wine", example: "verre de vin", exampleTranslation: "glass of wine", rating: 0 },
            // New words from page 4
            { french: "eau", pos: "noun (fem)", translation: "water", example: "Puis-je avoir de l'eau, s'il vous plaît ?", exampleTranslation: "Can I have some water, please?", rating: 0 },
            // Food from page 4
            { french: "boeuf", pos: "noun (masc)", translation: "beef", example: "steak de bœuf", exampleTranslation: "beef steak", rating: 0 },
            { french: "porc", pos: "noun (masc)", translation: "pork", example: "Le porc est de la viande de cochon.", exampleTranslation: "Pork is meat from a pig.", rating: 0 },
            { french: "poulet", pos: "noun (masc)", translation: "chicken", example: "viande de poulet", exampleTranslation: "chicken meat", rating: 0 },
            { french: "poisson", pos: "noun (masc)", translation: "fish", example: "un poisson d'eau douce", exampleTranslation: "a freshwater fish", rating: 0 },
            { french: "pâté", pos: "noun (masc)", translation: "pie", example: "pâté aux pommes", exampleTranslation: "apple pie", rating: 0 },
            { french: "pain", pos: "noun (masc)", translation: "bread", example: "pain blanc", exampleTranslation: "white bread", rating: 0 },
            { french: "soupe", pos: "noun (fem)", translation: "soup", example: "soupe de légumes", exampleTranslation: "vegetable soup", rating: 0 },
            { french: "riz", pos: "noun (masc)", translation: "rice", example: "bol de riz", exampleTranslation: "bowl of rice", rating: 0 },
            { french: "pomme", pos: "noun (fem)", translation: "apple", example: "Mangez la pomme.", exampleTranslation: "Eat the apple.", rating: 0 },
            { french: "orange", pos: "noun (fem)", translation: "orange", example: "couleur orange", exampleTranslation: "orange color", rating: 0 },
            { french: "sucre", pos: "noun (masc)", translation: "sugar", example: "mettre du sucre dans le café", exampleTranslation: "to put sugar in the coffee", rating: 0 },
            { french: "sel", pos: "noun (masc)", translation: "salt", example: "ajouter du sel", exampleTranslation: "to add salt", rating: 0 },
            // Clothing from page 5
            { french: "chemise", pos: "noun (fem)", translation: "shirt", example: "porter une chemise", exampleTranslation: "to wear a shirt", rating: 0 },
            { french: "pantalon", pos: "noun (masc)", translation: "pants", example: "un nouveau pantalon", exampleTranslation: "a new pair of pants", rating: 0 },
            { french: "robe", pos: "noun (fem)", translation: "dress", example: "robe de mariée", exampleTranslation: "wedding dress", rating: 0 },
            { french: "chaussures", pos: "noun (fem, plural)", translation: "shoes", example: "chaussures pour hommes", exampleTranslation: "men's shoes", rating: 0 },
            // Body Parts/Health from page 5
            { french: "tête", pos: "noun (fem)", translation: "head", example: "Portez un casque pour protéger votre tête.", exampleTranslation: "Wear a helmet to protect your head.", rating: 0 },
            { french: "bras", pos: "noun (masc)", translation: "arm", example: "deux bras", exampleTranslation: "two arms", rating: 0 },
            { french: "main", pos: "noun (fem)", translation: "hand", example: "L'enfant lève la main.", exampleTranslation: "The child raises his hand.", rating: 0 },
            { french: "doigt", pos: "noun (masc)", translation: "finger", example: "Mon doigt saigne.", exampleTranslation: "My finger is bleeding.", rating: 0 },
            { french: "corps", pos: "noun (masc)", translation: "body", example: "corps humain", exampleTranslation: "human body", rating: 0 },
            { french: "estomac", pos: "noun (masc)", translation: "stomach", example: "Le docteur porte une maquette d'estomac.", exampleTranslation: "The doctor is wearing a stomach model.", rating: 0 },
            { french: "dos", pos: "noun (masc)", translation: "back", example: "Mon dos me fait mal.", exampleTranslation: "My back hurts.", rating: 0 },
            { french: "poitrine", pos: "noun (fem)", translation: "chest", example: "J'ai une douleur à la poitrine.", exampleTranslation: "I have a pain in my chest.", rating: 0 },
            // Professions from page 5
            { french: "infirmière", pos: "noun (fem)", translation: "nurse (female)", example: "La femme est infirmière.", exampleTranslation: "The woman is a nurse.", rating: 0 },
            { french: "employé", pos: "noun (masc)", translation: "employee (male)", example: "Les employés ont une réunion.", exampleTranslation: "The employees have a meeting.", rating: 0 },
            { french: "enseignant", pos: "noun (masc)", translation: "teacher (male)", example: "Notre professeur de français parle sa langue maternelle à la maison.", exampleTranslation: "Our French teacher speaks her native language at home.", rating: 0 },
            { french: "programmeur", pos: "noun (masc)", translation: "programmer", example: "Je suis programmeur.", exampleTranslation: "I am a programmer.", rating: 0 },
            // New word from page 5
            { french: "vendeur", pos: "noun (masc)", translation: "salesman", example: "vendeur de voiture", exampleTranslation: "car salesman", rating: 0 }
        ];

        // --- Data Management and State ---
        // Main data array - will be populated from local storage or defaults
        let frenchWords = [];
        // App state
        let currentView = 'grid';
        let currentQuizIndex = 0;
        let quizQuestions = [];
        let quizScore = { correct: 0, total: 0 };
        // Flag to control which set of words to use for the quiz
        let quizWordFilter = 'all'; // 'all' or 'mastered'
        // Filters for grid view
        let searchQuery = '';
        let categoryFilter = 'all';

        // DOM elements
        const gridView = document.getElementById('grid-view');
        const quizView = document.getElementById('quiz-view');
        const gridViewBtn = document.getElementById('grid-view-btn');
        const quizViewBtn = document.getElementById('quiz-view-btn');
        const quizQuestion = document.getElementById('quiz-question');
        const quizWord = document.getElementById('quiz-word');
        const quizOptions = document.getElementById('quiz-options');
        const quizFeedback = document.getElementById('quiz-feedback');
        const feedbackTitle = document.getElementById('feedback-title');
        const feedbackText = document.getElementById('feedback-text');
        const nextQuestionBtn = document.getElementById('next-question');
        const currentQuestionElement = document.getElementById('current-question');
        const totalQuestionsElement = document.getElementById('total-questions');
        const quizProgress = document.getElementById('quiz-progress');
        const quizScoreElement = document.getElementById('quiz-score');
        const startQuizBtn = document.getElementById('start-quiz');
        const practiceMasteredBtn = document.getElementById('practice-mastered');
        const audioPlayer = document.getElementById('audio-player'); // Shared player (used in fallback/old logic)
        const searchInput = document.getElementById('search-input');
        const categoryFilterSelect = document.getElementById('category-filter');

        // New Modal/Form elements
        const addNewWordBtn = document.getElementById('add-new-word');
        const modalOverlay = document.getElementById('word-modal-overlay');
        const modalCloseBtn = document.getElementById('modal-close-btn');
        const modalCancelBtn = document.getElementById('modal-cancel-btn');
        const modalSaveBtn = document.getElementById('modal-save-btn');
        const modalDeleteBtn = document.getElementById('modal-delete-btn');
        const modalTitle = document.getElementById('modal-title');
        const wordForm = document.getElementById('word-form');
        const wordIndexInput = document.getElementById('word-index');
        const totalWordsStat = document.getElementById('total-words-stat');
        const masteredWordsStat = document.getElementById('mastered-words-stat');
        const quizAccuracyStat = document.getElementById('quiz-accuracy-stat');

        // --- Utility Functions ---

        // Helper for rating text
        function getRatingText(rating) {
            switch (rating) {
                case 1: return "1 - Forgot";
                case 2: return "2 - Needs Work";
                case 3: return "3 - Know It";
                case 4: return "4 - Almost Mastered";
                case 5: return "5 - Mastered";
                default: return "Not rated yet";
            }
        }

        // Get words filtered by current search & category
        function getFilteredWords() {
            const query = searchQuery.trim().toLowerCase();
            return frenchWords.filter(word => {
                // Category (use part of speech as the "category")
                if (categoryFilter !== 'all') {
                    if (!word.pos || word.pos.toLowerCase() !== categoryFilter.toLowerCase()) {
                        return false;
                    }
                }

                // Search
                if (!query) return true;
                const fields = [
                    word.french || '',
                    word.translation || '',
                    word.example || '',
                    word.exampleTranslation || '',
                    word.pos || ''
                ]
                    .join(' ')
                    .toLowerCase();
                return fields.includes(query);
            });
        }

        // Populate category dropdown from distinct parts of speech
        function populateCategoryFilterOptions() {
            if (!categoryFilterSelect) return;
            const seen = new Set();
            // Clear everything except the first "All" option
            categoryFilterSelect.innerHTML = '<option value="all">All categories</option>';
            frenchWords.forEach(word => {
                if (!word.pos) return;
                const key = word.pos.trim();
                if (!key || seen.has(key.toLowerCase())) return;
                seen.add(key.toLowerCase());
                const opt = document.createElement('option');
                opt.value = key;
                opt.textContent = key;
                categoryFilterSelect.appendChild(opt);
            });
        }
        
        
        // --- Audio Pronunciation (Baidu TTS) ---
       // --- 语音播放函数（兼容中国网络环境）---
function playAudio(text, lang = "fr-FR") {
    // 检查浏览器是否支持 speechSynthesis
    if (!window.speechSynthesis) {
        alert("您的浏览器不支持语音合成功能。");
        return;
    }

    // 如果正在播放，先停止
    if (speechSynthesis.speaking) {
        speechSynthesis.cancel();
    }

    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = lang;
    utterance.rate = 1.0;
    utterance.pitch = 1.0;
    utterance.volume = 1.0;

    // 尝试获取可用的语音包（特别是中文或法语）
    const voices = speechSynthesis.getVoices();
    
    // 优先选择法语语音，如果没有则使用默认语音
    const frenchVoice = voices.find(voice => voice.lang.startsWith('fr'));
    if (frenchVoice) {
        utterance.voice = frenchVoice;
    } else if (voices.length > 0) {
        utterance.voice = voices[0]; // 使用第一个可用语音
    }

    utterance.onerror = function(event) {
        console.error("语音播放失败:", event);
        alert("语音播放失败，请确保您的浏览器支持语音合成或检查网络连接。");
    };

    // 开始播放
    speechSynthesis.speak(utterance);
}

// 确保语音列表已加载（某些浏览器需要）
if (speechSynthesis.onvoiceschanged !== undefined) {
    speechSynthesis.onvoiceschanged = function() {
        console.log("语音列表已加载");
    };
}
        // **********************************************

        // Update statistical counters
        function updateStats() {
            const total = frenchWords.length;
            const mastered = frenchWords.filter(w => w.rating === 5).length;
            const accuracy = quizScore.total > 0 ? ((quizScore.correct / quizScore.total) * 100).toFixed(0) : 0;

            totalWordsStat.textContent = total;
            masteredWordsStat.textContent = mastered;
            quizAccuracyStat.textContent = `${accuracy}%`;
            
            // Disable the 'Practice Mastered' button if there are no mastered words
            practiceMasteredBtn.disabled = mastered === 0;
            if (mastered === 0) {
                 practiceMasteredBtn.title = "No words have a 'Mastered' rating (5) yet.";
                 practiceMasteredBtn.classList.add('btn-secondary');
                 practiceMasteredBtn.classList.remove('btn-primary');
            } else {
                 practiceMasteredBtn.title = "";
                 practiceMasteredBtn.classList.add('btn-primary');
                 practiceMasteredBtn.classList.remove('btn-secondary');
            }
            
            // Disable the 'Start Quiz' button if there are no words
            startQuizBtn.disabled = total === 0;
            if (total === 0) {
                startQuizBtn.title = "Add words to start a quiz.";
            } else {
                startQuizBtn.title = "";
            }
        }

        // --- Data Persistence ---

        // Load data from localStorage or use defaults
        function loadVocabularyData() {
            try {
                const storedWords = localStorage.getItem('frenchWords');
                const storedQuizScore = localStorage.getItem('quizScore');

                if (storedWords) {
                    // Filter out null/invalid entries for safety
                    frenchWords = JSON.parse(storedWords).filter(w => w && w.french);
                } else {
                    frenchWords = DEFAULT_FRENCH_WORDS;
                }
                
                if (storedQuizScore) {
                    quizScore = JSON.parse(storedQuizScore);
                }
            } catch (e) {
                console.error("Could not load vocabulary data. Using defaults.", e);
                frenchWords = DEFAULT_FRENCH_WORDS;
            }
        }

        // Save data to localStorage
        function saveVocabularyData() {
            try {
                localStorage.setItem('frenchWords', JSON.stringify(frenchWords));
                localStorage.setItem('quizScore', JSON.stringify(quizScore));
            } catch (e) {
                console.error("Could not save vocabulary data.", e);
            }
        }

        // --- CRUD Operations ---

        function openWordModal(index = null) {
            wordForm.reset();
            wordIndexInput.value = '';
            modalDeleteBtn.style.display = 'none';

            if (index !== null && index >= 0 && index < frenchWords.length) {
                // Edit existing word
                const word = frenchWords[index];
                modalTitle.textContent = `Edit Word: ${word.french}`;
                wordIndexInput.value = index;
                document.getElementById('french-word').value = word.french;
                document.getElementById('word-pos').value = word.pos;
                document.getElementById('word-translation').value = word.translation;
                document.getElementById('example-french').value = word.example;
                document.getElementById('example-translation').value = word.exampleTranslation;
                modalDeleteBtn.style.display = 'block';
            } else {
                // Add new word
                modalTitle.textContent = 'Add New Word';
                modalDeleteBtn.style.display = 'none';
            }
            modalOverlay.style.display = 'flex';
        }

        function closeWordModal() {
            modalOverlay.style.display = 'none';
            wordForm.reset();
        }

        function handleWordFormSubmit(e) {
            e.preventDefault();
            const index = wordIndexInput.value === '' ? null : parseInt(wordIndexInput.value);
            
            const newWord = {
                french: document.getElementById('french-word').value.trim(),
                pos: document.getElementById('word-pos').value.trim(),
                translation: document.getElementById('word-translation').value.trim(),
                example: document.getElementById('example-french').value.trim(),
                exampleTranslation: document.getElementById('example-translation').value.trim(),
                // Keep existing rating if editing, otherwise default to 0
                rating: index !== null ? frenchWords[index].rating : 0
            };

            if (index !== null) {
                // Edit/Update existing word
                frenchWords[index] = newWord;
                alert(`Word "${newWord.french}" updated successfully.`);
            } else {
                // Add new word
                frenchWords.unshift(newWord); // Add to the beginning for easy viewing
                alert(`New word "${newWord.french}" added successfully.`);
            }

            saveVocabularyData();
            renderGridCards();
            updateStats();
            closeWordModal();
            if (navigator.vibrate) navigator.vibrate(50);
        }

        function deleteWord(index) {
            if (index !== null && index >= 0 && index < frenchWords.length) {
                const wordToDelete = frenchWords[index];
                if (confirm(`Are you sure you want to delete the word "${wordToDelete.french}"? This action cannot be undone.`)) {
                    frenchWords.splice(index, 1);
                    saveVocabularyData();
                    renderGridCards();
                    updateStats();
                    closeWordModal();
                    alert(`Word "${wordToDelete.french}" deleted.`);
                    if (navigator.vibrate) navigator.vibrate(300);
                }
            }
        }
        
        // Function to update the rating of a word and save
        function updateRating(index, newRating) {
            frenchWords[index].rating = newRating;
            
            // Re-render the specific card and update stats
            renderGridCards();
            updateStats();
            saveVocabularyData();
            
            // Re-apply listeners for newly rendered cards
            setupGridCardListeners();
        }

        // --- Render Functions (Updated) ---

        // Generate HTML for a single word card (UPDATED to include Edit button)
        function createWordCardHTML(word, index) {
            return `
                <div class="word-card" data-index="${index}">
                    <div class="word-header">
                        <div class="word-french">${word.french}</div>
                        <div class="word-pos">${word.pos}</div>
                        <button class="word-pronounce-btn" data-text="${word.french}" aria-label="Pronounce word">
                            <i class="fas fa-volume-up"></i>
                        </button>
                    </div>
                    <div class="word-body">
                        <div class="word-translation">${word.translation}</div>
                        <div class="example-container">
                            <div class="example-french-wrapper">
                                <div class="example-french">"${word.example}"</div>
                                <button class="pronounce-example-btn" data-text="${word.example}" aria-label="Pronounce example sentence">
                                    <i class="fas fa-volume-up"></i>
                                </button>
                            </div>
                            <div class="example-translation">${word.exampleTranslation}</div>
                        </div>
                        <div class="card-actions">
                            <button class="btn btn-secondary btn-sm edit-word-btn" data-index="${index}">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                        </div>
                        <div class="rating-section">
                            <span class="rating-label">Your Rating:</span>
                            <div class="rating-controls">
                                ${[1,2,3,4,5].map(rating => `
                                    <button class="rating-btn rating-${rating} ${word.rating === rating ? 'active' : ''}" data-index="${index}" data-rating="${rating}" aria-label="Rate ${rating} - ${getRatingText(rating)}">
                                        ${rating}
                                    </button>
                                `).join('')}
                            </div>
                            <div class="rating-text">
                                ${getRatingText(word.rating)}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Render all word cards (UPDATED to call setupEditListeners)
        function renderGridCards() {
            const words = getFilteredWords();
            if (words.length === 0) {
                gridView.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 2rem; background: var(--glass-bg); border-radius: var(--radius-md); box-shadow: var(--shadow-md); color: var(--gray-600);">
                        No words match your search or category filter.
                    </div>
                `;
            } else {
                gridView.innerHTML = words
                    .map(word => {
                        const originalIndex = frenchWords.indexOf(word);
                        return createWordCardHTML(word, originalIndex);
                    })
                    .join('');
            }
            setupGridCardListeners();
            setupEditListeners();
        }

        // Set up listeners for the word cards (rating and pronounce)
        function setupGridCardListeners() {
            document.querySelectorAll('.rating-btn').forEach(button => {
                button.onclick = function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    const newRating = parseInt(this.getAttribute('data-rating'));
                    updateRating(index, newRating);
                    if (navigator.vibrate) navigator.vibrate(20);
                };
            });

            document.querySelectorAll('.word-pronounce-btn').forEach(button => {
                button.onclick = function() {
                    playAudio(this.getAttribute('data-text'));
                    if (navigator.vibrate) navigator.vibrate(10);
                };
            });
            
            document.querySelectorAll('.pronounce-example-btn').forEach(button => {
                button.onclick = function() {
                    playAudio(this.getAttribute('data-text'));
                    if (navigator.vibrate) navigator.vibrate(10);
                };
            });
        }
        
        // Set up listeners for edit/delete buttons on cards
        function setupEditListeners() {
             document.querySelectorAll('.edit-word-btn').forEach(button => {
                button.onclick = function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    openWordModal(index);
                    if (navigator.vibrate) navigator.vibrate(50);
                };
            });
        }

        // --- Quiz Functions ---

        // Generate quiz questions
        function generateQuizQuestions(wordsToUse = null) {
            quizQuestions = [];
            let selectedWords = wordsToUse || [...frenchWords];
            
            // Filter out words with no translation or French word (to prevent errors in quiz)
            selectedWords = selectedWords.filter(w => w.translation && w.french);

            // Ensure there are enough words to quiz
            if (selectedWords.length === 0) {
                 // If there are no words, clear the quiz
                totalQuestionsElement.textContent = 0;
                quizScoreElement.textContent = `0/0`;
                quizProgress.style.width = '0%';
                quizQuestion.innerHTML = "No words available for a quiz. Add some to get started!";
                quizOptions.innerHTML = '';
                nextQuestionBtn.style.display = 'none';
                return;
            }
            
            const shuffled = [...selectedWords].sort(() => 0.5 - Math.random());
            const wordsForQuiz = shuffled.slice(0, Math.min(10, selectedWords.length)); // Max 10 questions

            wordsForQuiz.forEach(word => {
                const wrongAnswers = [];
                // Collect all translations, excluding the current word's translation
                const allTranslations = frenchWords.map(w => w.translation).filter(t => t !== word.translation);
                
                // Shuffle all available translations
                const shuffledTranslations = [...allTranslations].sort(() => 0.5 - Math.random());

                // Pick up to 3 unique wrong answers
                for(let i = 0; i < Math.min(3, shuffledTranslations.length); i++) {
                     wrongAnswers.push(shuffledTranslations[i]);
                }

                const question = {
                    word: word.french,
                    pos: word.pos,
                    correctAnswer: word.translation,
                    example: word.example,
                    exampleTranslation: word.exampleTranslation,
                    wrongAnswers: wrongAnswers,
                };
                quizQuestions.push(question);
            });
            
            totalQuestionsElement.textContent = quizQuestions.length;
            updateQuizProgress();
        }

        // Update progress bar and score display
        function updateQuizProgress() {
            const total = quizQuestions.length;
            const progress = (currentQuizIndex / total) * 100;
            quizProgress.style.width = `${progress}%`;
            currentQuestionElement.textContent = Math.min(currentQuizIndex + 1, total);
            quizScoreElement.textContent = `${quizScore.correct}/${quizScore.total}`;
        }

        // Show the completion screen
        function showQuizCompletion() {
            const scorePercent = quizScore.total > 0 ? (quizScore.correct / quizScore.total) * 100 : 0;
            let completionMessage = '';
            let emoji = '';

            if (scorePercent === 100 && quizScore.total > 0) {
                completionMessage = 'Perfect Score! Amazing work!';
                emoji = '🎉';
            } else if (scorePercent >= 75) {
                completionMessage = 'Great job! You are mastering these words.';
                emoji = '👍';
            } else if (scorePercent >= 50) {
                completionMessage = 'Solid effort. Keep practicing to improve!';
                emoji = '✍️';
            } else {
                completionMessage = 'You got this! Review the words and try again.';
                emoji = '🧐';
            }
            
            const quizCard = document.querySelector('.quiz-view .quiz-card');
            quizCard.innerHTML = `
                <div class="progress-container" style="margin-bottom: 2rem;">
                    <div class="progress-info" style="justify-content: center;">
                        <span style="font-size: 1.5rem; color: var(--secondary);">${emoji} Quiz Complete! ${emoji}</span>
                    </div>
                </div>
                <div style="text-align: center; padding: 2rem; background: var(--glass-bg); border-radius: var(--radius-md); box-shadow: var(--shadow-md);">
                    <div class="stat-number" style="font-size: 4rem; margin-bottom: 0.5rem; background: var(--gradient-accent); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;">
                        ${quizScore.correct}/${quizScore.total}
                    </div>
                    <div class="stat-label" style="font-size: 1.5rem; margin-bottom: 1rem;">
                        ${completionMessage}
                    </div>
                    <p style="color: var(--gray-600); margin-bottom: 2rem;">
                        Your final score is ${quizScore.correct} correct out of ${quizScore.total} questions.
                    </p>
                    <button class="btn btn-primary" id="restart-quiz" style="margin-bottom: 15px;">
                        <i class="fas fa-redo-alt"></i> Restart Quiz
                    </button>
                     <button class="btn btn-secondary" id="back-to-grid">
                        <i class="fas fa-th-large"></i> View Vocabulary
                    </button>
                </div>
            `;
            
            document.getElementById('restart-quiz').addEventListener('click', function() {
                currentQuizIndex = 0;
                quizScore = { correct: 0, total: 0 };
                generateQuizQuestions(quizWordFilter === 'mastered' ? frenchWords.filter(w => w.rating === 5) : null);
                updateQuizQuestion();
                if (navigator.vibrate) navigator.vibrate(50);
            });

            document.getElementById('back-to-grid').addEventListener('click', function() {
                switchView('grid');
                if (navigator.vibrate) navigator.vibrate(30);
            });
        }

        // Update quiz question display
        function updateQuizQuestion() {
            if (currentQuizIndex >= quizQuestions.length) {
                showQuizCompletion();
                return;
            }

            // Reset quiz card content (re-injecting structure to clear previous state/listeners)
            const quizCard = document.querySelector('.quiz-view .quiz-card');
            quizCard.innerHTML = `
                <div class="quiz-question" id="quiz-question"></div>
                <div class="quiz-options" id="quiz-options"></div>
                <div class="quiz-feedback" id="quiz-feedback">
                    <div class="feedback-title" id="feedback-title"></div>
                    <div class="feedback-text" id="feedback-text"></div>
                </div>
                <button class="btn btn-primary" id="next-question" style="display: none;">
                    Next Question <i class="fas fa-arrow-right"></i>
                </button>
            `;

            // Re-fetch elements for the new content
            const currentQuizQuestionEl = quizCard.querySelector('#quiz-question');
            const currentQuizOptionsEl = quizCard.querySelector('#quiz-options');
            const currentQuizFeedbackEl = quizCard.querySelector('#quiz-feedback');
            const currentFeedbackTitleEl = quizCard.querySelector('#feedback-title');
            const currentFeedbackTextEl = quizCard.querySelector('#feedback-text');
            const currentNextQuestionBtn = quizCard.querySelector('#next-question');

            const question = quizQuestions[currentQuizIndex];

            currentQuizQuestionEl.innerHTML = `What is the English meaning of <span class="quiz-word">${question.word}</span> (${question.pos})?`;

            // Add pronunciation button
            const pronounceBtn = document.createElement('button');
            pronounceBtn.className = 'btn btn-secondary';
            pronounceBtn.style.marginBottom = '1.5rem';
            pronounceBtn.style.width = '100%';
            pronounceBtn.innerHTML = '<i class="fas fa-volume-up"></i> Hear Pronunciation';
            pronounceBtn.onclick = () => {
                playAudio(question.word);
                if (navigator.vibrate) navigator.vibrate(20);
            };

            // Combine and shuffle answers
            const allAnswers = [question.correctAnswer, ...question.wrongAnswers];
            const shuffledAnswers = [...allAnswers].sort(() => 0.5 - Math.random());

            // Generate answer buttons
            currentQuizOptionsEl.innerHTML = '';
            currentQuizOptionsEl.appendChild(pronounceBtn); // Place the pronounce button first

            shuffledAnswers.forEach(answer => {
                const button = document.createElement('button');
                button.className = 'quiz-option';
                button.textContent = answer;
                button.onclick = (e) => handleQuizOptionClick(e, answer, question.correctAnswer, currentQuizOptionsEl, currentQuizFeedbackEl, currentFeedbackTitleEl, currentFeedbackTextEl, currentNextQuestionBtn, question);
                currentQuizOptionsEl.appendChild(button);
            });

            // Set up next question button listener
            currentNextQuestionBtn.onclick = function() {
                currentQuizIndex++;
                updateQuizProgress();
                updateQuizQuestion();
                saveVocabularyData(); // Save rating changes from the quiz
                if (navigator.vibrate) navigator.vibrate(30);
            };
            
            updateQuizProgress(); // Update progress/score display
        }

        // Handle option click in quiz
        function handleQuizOptionClick(e, selectedAnswer, correctAnswer, optionsEl, feedbackEl, feedbackTitleEl, feedbackTextEl, nextBtn, question) {
            // Check if already answered
            if (optionsEl.classList.contains('answered')) {
                return;
            }

            optionsEl.classList.add('answered');
            quizScore.total++;
            
            // Find the word in the main array to update its rating
            const wordIndex = frenchWords.findIndex(w => w.french === question.word);

            if (selectedAnswer === correctAnswer) {
                quizScore.correct++;
                e.currentTarget.classList.add('correct');
                feedbackTitleEl.innerHTML = `<i class="fas fa-check-circle" style="color: #06d6a0;"></i> Correct!`;
                feedbackTextEl.innerHTML = `
                    <strong>${question.word}</strong> means <strong>"${correctAnswer}"</strong>.<br><br>
                    <strong>Example:</strong> ${question.example}
                    <button class="pronounce-example-btn" data-text="${question.example}" style="margin-left: 10px; background: var(--gradient-accent); width: 32px; height: 32px; min-width: 32px; margin-top: 0;" aria-label="Pronounce example sentence">
                        <i class="fas fa-volume-up"></i>
                    </button>
                `;
                // Increase rating for correct answer, max 5
                if (wordIndex > -1 && frenchWords[wordIndex].rating < 5) {
                    frenchWords[wordIndex].rating = Math.min(5, frenchWords[wordIndex].rating + 1);
                }
                if (navigator.vibrate) navigator.vibrate([10, 50, 10]);
            } else {
                e.currentTarget.classList.add('wrong');
                // Find and highlight the correct answer
                Array.from(optionsEl.children).forEach(btn => {
                    if (btn.textContent === correctAnswer) {
                        btn.classList.add('correct');
                    }
                });
                feedbackTitleEl.innerHTML = `<i class="fas fa-times-circle" style="color: var(--error);"></i> Incorrect.`;
                feedbackTextEl.innerHTML = `
                    The correct translation for <strong>${question.word}</strong> is <strong>"${correctAnswer}"</strong>.<br><br>
                    <strong>Example:</strong> ${question.example}
                    <button class="pronounce-example-btn" data-text="${question.example}" style="margin-left: 10px; background: var(--gradient-accent); width: 32px; height: 32px; min-width: 32px; margin-top: 0;" aria-label="Pronounce example sentence">
                        <i class="fas fa-volume-up"></i>
                    </button>
                `;
                // Decrease rating for incorrect answer, min 1 (or 0 if you prefer to keep unrated)
                if (wordIndex > -1 && frenchWords[wordIndex].rating > 1) {
                    frenchWords[wordIndex].rating = Math.max(1, frenchWords[wordIndex].rating - 1);
                }
                if (navigator.vibrate) navigator.vibrate(300);
            }

            // Disable all options and show feedback/next button
            Array.from(optionsEl.children).forEach(btn => btn.disabled = true);
            feedbackEl.classList.add('show');
            nextBtn.style.display = 'block';
            updateQuizProgress();
            updateStats();
            
            // Setup listener for example pronunciation in feedback
            feedbackTextEl.querySelector('.pronounce-example-btn').onclick = function() {
                playAudio(this.getAttribute('data-text'));
                if (navigator.vibrate) navigator.vibrate(10);
            };
        }

        // --- Event Listeners and Initialization ---

        function setupEventListeners() {
            // View Toggle buttons
            gridViewBtn.addEventListener('click', () => switchView('grid'));
            quizViewBtn.addEventListener('click', () => {
                quizWordFilter = 'all'; // Default to all words when switching view
                generateQuizQuestions(); // Re-generate/start quiz
                switchView('quiz');
            });
            
            // Start Quiz button
            startQuizBtn.addEventListener('click', () => {
                currentQuizIndex = 0;
                quizScore = { correct: 0, total: 0 };
                quizWordFilter = 'all';
                generateQuizQuestions();
                switchView('quiz');
                if (navigator.vibrate) navigator.vibrate(50);
            });
            
            // Practice Mastered button
            practiceMasteredBtn.addEventListener('click', () => {
                const masteredWords = frenchWords.filter(w => w.rating === 5);
                if (masteredWords.length > 0) {
                    currentQuizIndex = 0;
                    quizScore = { correct: 0, total: 0 };
                    quizWordFilter = 'mastered';
                    generateQuizQuestions(masteredWords);
                    switchView('quiz');
                    if (navigator.vibrate) navigator.vibrate(50);
                } else {
                    alert("No words have a 'Mastered' rating (5) yet. Keep practicing!");
                }
            });

            // Modal buttons
            addNewWordBtn.addEventListener('click', () => openWordModal(null));
            modalCloseBtn.addEventListener('click', closeWordModal);
            modalCancelBtn.addEventListener('click', closeWordModal);
            wordForm.addEventListener('submit', handleWordFormSubmit);
            modalDeleteBtn.addEventListener('click', () => {
                const index = wordIndexInput.value === '' ? null : parseInt(wordIndexInput.value);
                deleteWord(index);
            });

            // Prevent scroll while modal is open
            modalOverlay.addEventListener('touchmove', function(event) {
                if (event.target === modalOverlay) {
                    event.preventDefault();
                }
            }, { passive: false });

            // Search input
            if (searchInput) {
                searchInput.addEventListener('input', () => {
                    searchQuery = searchInput.value || '';
                    renderGridCards();
                });
            }

            // Category filter
            if (categoryFilterSelect) {
                categoryFilterSelect.addEventListener('change', () => {
                    categoryFilter = categoryFilterSelect.value || 'all';
                    renderGridCards();
                });
            }
            
            // Re-render on orientation change (iOS fix for layout glitches)
            if ('orientationchange' in window) {
                window.addEventListener('orientationchange', function() {
                    setTimeout(function() {
                        if (currentView === 'grid') {
                            renderGridCards();
                        } else {
                            updateQuizQuestion();
                        }
                    }, 300);
                });
            }

        }

        // Switch between views
        function switchView(view) {
            currentView = view;
            
            // Update active button
            gridViewBtn.classList.toggle('active', view === 'grid');
            quizViewBtn.classList.toggle('active', view === 'quiz');
            
            // Show/hide views
            gridView.style.display = view === 'grid' ? 'grid' : 'none';
            quizView.style.display = view === 'quiz' ? 'block' : 'none';
            
            // If switching to quiz view, update the quiz
            if (view === 'quiz') {
                updateQuizQuestion();
            }
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // --- Initialization ---
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            loadVocabularyData(); // Load saved words or default
            populateCategoryFilterOptions();
            renderGridCards();
            updateStats();
            setupEventListeners();
            generateQuizQuestions();
            document.body.classList.add('loaded');
        });
    </script>
</body>
</html>
